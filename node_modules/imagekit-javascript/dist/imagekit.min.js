!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImageKit=t()}(this,(function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){e(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}))}return n}var r={height:"h",width:"w",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",x:"x",y:"y",focus:"fo",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig"},o=["path","query"],i=function(){return"path"},a=function(e){return"query"===e.transformationPosition},s=function(e){return-1!=o.indexOf(e.transformationPosition)},u=function(e){return e&&(r[e]||r[e.toLowerCase()])||""},p=function(){return":"},f=function(){return","},l=function(){return"-"},c=function(e){if(!e.path&&!e.src)return"";var t,n,r;if(e.path?(r=new URL(e.urlEndpoint).pathname,t=new URL(y([e.urlEndpoint.replace(r,""),e.path]))):(t=new URL(e.src),n=!0),!t)return"";for(var o in e.sdkVersion&&""!=e.sdkVersion.trim()&&t.searchParams.append("ik-sdk-version",e.sdkVersion.trim()),e.queryParameters)t.searchParams.append(o,e.queryParameters[o]);var i=function(e){if(!Array.isArray(e))return"";for(var t=[],n=0,r=e.length;n<r;n++){var o=[];for(var i in e[n]){var a=u(i);if(a||(a=i),"-"===e[n][i])o.push(a);else{var s=e[n][i];"oi"===a&&(s=(s=d(s)).replace(/\//g,"@@")),o.push([a,s].join(l()))}}t.push(o.join(f()))}return t.join(p())}(e.transformation);return i&&i.length&&(a(e)||n?t.searchParams.append("tr",i):t.pathname=y(["tr"+p()+i,t.pathname])),t.pathname=y([r,t.pathname]),t.href};function d(e){return"string"==typeof e&&"/"==e[0]&&(e=e.slice(1)),e}function y(e,t){var n=t||"/",r=new RegExp(n+"{1,}","g");return e.join(n).replace(r,n)}var I={MANDATORY_INITIALIZATION_MISSING:{message:"Missing urlEndpoint during SDK initialization",help:""},INVALID_TRANSFORMATION_POSITION:{message:"Invalid transformationPosition parameter",help:""},PRIVATE_KEY_CLIENT_SIDE:{message:"privateKey should not be passed on the client side",help:""},MISSING_UPLOAD_DATA:{message:"Missing data for upload",help:""},MISSING_UPLOAD_FILE_PARAMETER:{message:"Missing file parameter for upload",help:""},MISSING_UPLOAD_FILENAME_PARAMETER:{message:"Missing fileName parameter for upload",help:""},MISSING_AUTHENTICATION_ENDPOINT:{message:"Missing authentication endpoint for upload",help:""},AUTH_ENDPOINT_TIMEOUT:{message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},AUTH_ENDPOINT_NETWORK_ERROR:{message:"Request to authenticationEndpoint failed due to network error",help:""},UPLOAD_ENDPOINT_NETWORK_ERROR:{message:"Request to ImageKit upload endpoint failed due to network error",help:""}};function h(e,t,n){"function"==typeof n&&(e?n(t,null):n(null,t))}var T=function(e,t){var n=new XMLHttpRequest;n.timeout=6e4,n.open("GET",e.authenticationEndpoint),n.ontimeout=function(e){"function"==typeof t&&h(!0,I.AUTH_ENDPOINT_TIMEOUT,t)},n.onerror=function(){h(!0,I.AUTH_ENDPOINT_NETWORK_ERROR,t)},n.onload=function(){if(200===n.status)try{var e=JSON.parse(n.responseText),r={signature:e.signature,expire:e.expire,token:e.token};return void t(null,r)}catch(e){if("function"!=typeof t)return;t(e)}else try{var o=JSON.parse(n.responseText);if("function"!=typeof t)return;t(o)}catch(e){if("function"!=typeof t)return;t(e)}},n.send()},g=function(e,t){var n=new XMLHttpRequest;n.open("POST","https://upload.imagekit.io/api/v1/files/upload"),n.onerror=function(){h(!0,I.UPLOAD_ENDPOINT_NETWORK_ERROR,t)},n.onload=function(){if(200===n.status){if("function"!=typeof t)return;var e=JSON.parse(n.responseText);t(null,e)}else if(200!==n.status){if("function"!=typeof t)return;t(JSON.parse(n.responseText))}},n.send(e)},O=function(e,t,n){if(e)if(e.file)if(e.fileName)if(t.authenticationEndpoint){var r=new FormData;for(var o in e)r.append(o,e[o]);r.append("publicKey",t.publicKey),function(e,t,n){T(t,(function(t,r){if(t){if("function"!=typeof n)return;n(t,null)}else e.append("signature",r.signature||""),e.append("expire",r.expire||0),e.append("token",r.token),g(e,(function(e,t){if(e){if("function"!=typeof n)return;n(e,null)}else n(null,t)}))}))}(r,t,n)}else h(!0,I.MISSING_AUTHENTICATION_ENDPOINT,n);else h(!0,I.MISSING_UPLOAD_FILENAME_PARAMETER,n);else h(!0,I.MISSING_UPLOAD_FILE_PARAMETER,n);else h(!0,I.INVALID_UPLOAD_OPTIONS,n)},m="1.3.5";return function(e){if(e=e||{},this.options={sdkVersion:"javascript-".concat(m),publicKey:"",urlEndpoint:"",transformationPosition:i()},this.options=n(n({},this.options),e),!this.options.urlEndpoint)throw I.MANDATORY_INITIALIZATION_MISSING;if(function(e){return void 0!==e.privateKey}(this.options))throw I.PRIVATE_KEY_CLIENT_SIDE;if(!s(this.options))throw I.INVALID_TRANSFORMATION_POSITION;this.url=function(e){return function(e,t){var r=n(n({},t),e);return function(e){return!!e.urlEndpoint}(r)?c(r):""}(e,this.options)},this.upload=function(e,t,r){var o=n(n({},this.options),r);return O(e,o,t)}}}));
